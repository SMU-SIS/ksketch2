<?xml version="1.0" encoding="utf-8"?>
<!--
*Copyright 2010-2012 Singapore Management University
*Developed under a grant from the Singapore-MIT GAMBIT Game Lab

*This Source Code Form is subject to the terms of the
*Mozilla Public License, v. 2.0. If a copy of the MPL was
*not distributed with this file, You can obtain one at
*http://mozilla.org/MPL/2.0/.
-->
<s:SkinnablePopUpContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
						   xmlns:s="library://ns.adobe.com/flex/spark" backgroundAlpha="0" initialize="initStyle()">
	<fx:Script>
		<![CDATA[
			import mx.events.ItemClickEvent;
			import mx.core.FlexGlobals;
			import mx.events.FlexEvent;
			
			import spark.components.Application;
			
			import sg.edu.smu.ksketch2.KSketchStyles;
			import sg.edu.smu.ksketch2.canvas.KSketch_CanvasView_Preferences;
			import sg.edu.smu.ksketch2.canvas.components.timebar.KSketch_TimeControl;
			import sg.edu.smu.ksketch2.canvas.components.view.KSketch_CanvasView;
			import sg.edu.smu.ksketch2.model.data_structures.KKeyFrame;
			import sg.edu.smu.ksketch2.operators.KSingleReferenceFrameOperator;
			
			private var _canvasView:KSketch_CanvasView;
			private var _menu:KSketch_PopUp_Menu;
			public var mode:int;
			
			private function initStyle():void
			{
				this.removeEventListener(FlexEvent.INITIALIZE, initStyle);
				header.setStyle("fontSize", KSketchStyles.DIALOG_BUTTON_HEADER);
				closeButton.setStyle("fontSize", KSketchStyles.DIALOG_BUTTON_SIZE);
			}
			
			public function init(canvasView:KSketch_CanvasView, menu:KSketch_PopUp_Menu):void
			{
				_canvasView = canvasView;
				_menu = menu;
				
				_menu.open(_canvasView);
				KSketch_CanvasView_Preferences.menuOpen = KSketch_CanvasView_Preferences.OPEN;
			}
			
			override public function open(owner:DisplayObjectContainer, modal:Boolean=false):void
			{
				super.open(owner, modal);
			}
			
			public function applyPreferences():void
			{
				_timebarBottom();
				_autoInsertKey(false);
				_doubleTap(false);
				_menuOpen(true);
				_menuTop();
				
				//KSKETCH-SYNPHNE
				_tapAnywhere();
				_activityRecall();
				_difficultyEasy();
			}
			
			//KSKETCH-SYNPHNE
			//================================================================================================================
			private function _tapAnywhere():void
			{
				tapAnywhere.selected = true;
				KSketch_CanvasView_Preferences.tapAnywhere = KSketch_CanvasView_Preferences.TAPANYWHERE_ON;
			}
			
			private function _activityRecall():void
			{
				actRecall.selected = true;
				KSketch_CanvasView_Preferences.activity = KSketch_CanvasView_Preferences.ACTIVITY_RECALL;
			}
			
			private function _difficultyEasy():void
			{
				diffEasy.selected = true;
				KSketch_CanvasView_Preferences.difficulty = KSketch_CanvasView_Preferences.DIFFICULTY_EASY;
			}
			
			private function _initiation(event:ItemClickEvent):void
			{
				if (event.currentTarget.selectedValue == "anywhere") {
					KSketch_CanvasView_Preferences.tapAnywhere = KSketch_CanvasView_Preferences.TAPANYWHERE_ON;
				} else {
					KSketch_CanvasView_Preferences.tapAnywhere = KSketch_CanvasView_Preferences.TAPANYWHERE_OFF;
				}
			}
			
			private function _activity(event:ItemClickEvent):void
			{
				if (event.currentTarget.selectedValue == "Recall") {
					KSketch_CanvasView_Preferences.activity = KSketch_CanvasView_Preferences.ACTIVITY_RECALL;
				} else if (event.currentTarget.selectedValue == "Trace") {
					KSketch_CanvasView_Preferences.activity = KSketch_CanvasView_Preferences.ACTIVITY_TRACE;
				} else if (event.currentTarget.selectedValue == "Track") {
					KSketch_CanvasView_Preferences.activity = KSketch_CanvasView_Preferences.ACTIVITY_TRACK;
				} else {
					KSketch_CanvasView_Preferences.activity = KSketch_CanvasView_Preferences.ACTIVITY_RECREATE;
				}
			}
			
			private function _difficulty(event:ItemClickEvent):void
			{
				if (event.currentTarget.selectedValue == "Easy") {
					KSketch_CanvasView_Preferences.difficulty = KSketch_CanvasView_Preferences.DIFFICULTY_EASY;
				} else if (event.currentTarget.selectedValue == "Medium") {
					KSketch_CanvasView_Preferences.difficulty = KSketch_CanvasView_Preferences.DIFFICULTY_MEDIUM;
				} else {
					KSketch_CanvasView_Preferences.difficulty = KSketch_CanvasView_Preferences.DIFFICULTY_HARD;
				}
			}
			//================================================================================================================
			
			private function _timebarTop():void
			{
				if(_canvasView.mainCanvas.getElementIndex(_canvasView.timebar_group) <= _canvasView.mainCanvas.getElementIndex(_canvasView.canvas_component))
					return;

				_canvasView.mainCanvas.swapElements(_canvasView.timebar_group, _canvasView.canvas_component);
				KSketch_CanvasView_Preferences.timebarPosition = KSketch_CanvasView_Preferences.POS_TOP;
				_canvasView.timeControl.position = KSketch_TimeControl.BAR_TOP;
				_menu.dispatchEvent(new FlexEvent(FlexEvent.UPDATE_COMPLETE));
			}
			
			private function _timebarBottom():void
			{
				if(_canvasView.mainCanvas.getElementIndex(_canvasView.timebar_group) >= _canvasView.mainCanvas.getElementIndex(_canvasView.canvas_component))
					return;
				
				_canvasView.mainCanvas.swapElements(_canvasView.timebar_group, _canvasView.canvas_component);
				KSketch_CanvasView_Preferences.timebarPosition = KSketch_CanvasView_Preferences.POS_BOTTOM;
				_canvasView.timeControl.position = KSketch_TimeControl.BAR_BOTTOM;
				_menu.dispatchEvent(new FlexEvent(FlexEvent.UPDATE_COMPLETE));
			}
			
			private function _menuTop():void
			{
				_menu.position = KSketch_PopUp_Menu.UP;
				KSketch_CanvasView_Preferences.menuPosition = KSketch_CanvasView_Preferences.POS_TOP;
			}
			
			private function _menuLeft():void
			{
				_menu.position = KSketch_PopUp_Menu.LEFT;
				KSketch_CanvasView_Preferences.menuPosition = KSketch_CanvasView_Preferences.POS_LEFT;
			}
			
			private function _menuRight():void
			{
				_menu.position = KSketch_PopUp_Menu.RIGHT;
				KSketch_CanvasView_Preferences.menuPosition = KSketch_CanvasView_Preferences.POS_RIGHT;
			}
			
			private function _menuBottom():void
			{
				_menu.position = KSketch_PopUp_Menu.DOWN;
				KSketch_CanvasView_Preferences.menuPosition = KSketch_CanvasView_Preferences.POS_BOTTOM;
			}
			
			private function _menuOpen(value:Boolean):void
			{
				if(value)
				{
					_menu.open(_canvasView);
					KSketch_CanvasView_Preferences.menuOpen = KSketch_CanvasView_Preferences.OPEN;
				}
				else
					KSketch_CanvasView_Preferences.menuOpen = KSketch_CanvasView_Preferences.CLOSE;
			}
			
			private function _autoInsertKey(value:Boolean):void
			{
				if(value)
				{
					_setStudy(0);
					KSketch_CanvasView_Preferences.autoInsert = KSketch_CanvasView_Preferences.AUTO;
				}
				else
				{
					_setStudy(1);
					KSketch_CanvasView_Preferences.autoInsert = KSketch_CanvasView_Preferences.NOT_AUTO;
				}
			}
			
			private function _doubleTap(value:Boolean):void
			{
				if(value)
				{
					KSketch_CanvasView_Preferences.doubleTap = KSketch_CanvasView_Preferences.DOUBLETAP_ON;
				}
				else
				{
					KSketch_CanvasView_Preferences.doubleTap = KSketch_CanvasView_Preferences.DOUBLETAP_OFF;
				}
			}
			
			private function _autoLog(value:Boolean):void
			{
				if(value)
				{
					_canvasView.enableLog = true;
					KSketch_CanvasView_Preferences.autoLog = KSketch_CanvasView_Preferences.AUTOLOG_ON;
				}
				else
				{
					_canvasView.enableLog = false;
					KSketch_CanvasView_Preferences.autoLog = KSketch_CanvasView_Preferences.AUTOLOG_OFF;
				}
			}
			
			private function _setStudy(value:int):void
			{
				KSingleReferenceFrameOperator.mode = value;
				KSketch_Timebar_Context_Double.mode = value;
				KKeyFrame.mode = value;
				mode = value;
			}
			
			override public function close(commit:Boolean=false, data:*=null):void
			{
				super.close(commit, data);
				(FlexGlobals.topLevelApplication as Application).setFocus();
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<s:RadioButtonGroup id="difficultyGroup" itemClick="_difficulty(event);"/>
		<s:RadioButtonGroup id="activityGroup" itemClick="_activity(event);"/>
		<s:RadioButtonGroup id="initiationGroup" itemClick="_initiation(event);"/>
	</fx:Declarations>
	<s:filters>
		<s:DropShadowFilter 
			color="{KSketchStyles.CANVAS_SHADOW_COLOR}" angle="{KSketchStyles.CANVAS_SHADOW_ANGLE}"
			alpha="{KSketchStyles.CANVAS_SHADOW_ALPHA * 0.5}"
			strength="{KSketchStyles.CANVAS_SHADOW_STRENGTH}"
			blurX="{KSketchStyles.CANVAS_SHADOW_X_DISTANCE * 0.75}"
			blurY="{KSketchStyles.CANVAS_SHADOW_Y_DISTANCE * 0.75}"/>
	</s:filters>
	<s:Rect width="100%" height="100%" radiusX="{KSketchStyles.MENU_CORNER_RADIUS}" radiusY="{KSketchStyles.MENU_CORNER_RADIUS}">
		<s:fill>
			<s:SolidColor color="{KSketchStyles.MENU_BACKGROUND_COLOR}"/>
		</s:fill>
	</s:Rect>
	<s:Group>
		<s:layout>
			<s:VerticalLayout gap="{KSketchStyles.DIALOG_PADDING_20}" paddingLeft="{KSketchStyles.DIALOG_PADDING_15}" paddingRight="{KSketchStyles.DIALOG_PADDING_10}" paddingTop="{KSketchStyles.DIALOG_PADDING_20}" paddingBottom="{KSketchStyles.DIALOG_PADDING_10}"/>
		</s:layout>
		<s:Label id="header" text="Options"/>
		
		<s:Group>
			<s:layout>
				<s:VerticalLayout paddingLeft="10"/>
			</s:layout>
			<s:Label text="Activity" fontSize="18"/>
			<s:Group>
				<s:layout>
					<s:VerticalLayout/>
				</s:layout>
				
				<s:Group>
					<s:layout>
						<s:HorizontalLayout/>
					</s:layout>
					<s:RadioButton groupName="activityGroup" id="actRecall" value="Recall" label="Recall" fontSize="14"/>
					<s:RadioButton groupName="activityGroup" id="actTrace" value="Trace" label="Trace" fontSize="14"/>
					<s:RadioButton groupName="activityGroup" id="actTrack" value="Track" label="Track" fontSize="14"/>
					<s:RadioButton groupName="activityGroup" id="actRecreate" value="Recreate" label="Recreate" fontSize="14"/>
				</s:Group>
			</s:Group>
		</s:Group>
		
		<s:Group>
			<s:layout>
				<s:VerticalLayout paddingLeft="10"/>
			</s:layout>
			<s:Label text="Difficulty" fontSize="18"/>
			<s:Group>
				<s:layout>
					<s:VerticalLayout/>
				</s:layout>
				
				<s:Group>
					<s:layout>
						<s:HorizontalLayout/>
					</s:layout>
					<s:RadioButton groupName="difficultyGroup" id="diffEasy" value="Easy" label="Easy" fontSize="14"/>
					<s:RadioButton groupName="difficultyGroup" id="diffMed" value="Medium" label="Medium" fontSize="14"/>
					<s:RadioButton groupName="difficultyGroup" id="diffHard" value="Hard" label="Hard" fontSize="14"/>
				</s:Group>
				
				<s:Group>
					<s:layout>
						<s:HorizontalLayout/>
					</s:layout>
					<s:Label id="titleTime" text="Time{'\n'}Thres."/>
					<s:TextArea id="activityDuration" text="MM:SS" height="{KSketchStyles.DIALOG_MEASUREMENT_50}" width="150"/>
				</s:Group>
				
				<s:Group>
					<s:layout>
						<s:HorizontalLayout/>
					</s:layout>
					<s:Label id="titleAccuracy" text="Accu{'\n'}Thres."/>
					<s:TextArea id="accuracyThreshold" text="10%" height="{KSketchStyles.DIALOG_MEASUREMENT_50}" width="150"/>
				</s:Group>
			</s:Group>
		</s:Group>
		
		<s:Group>
			<s:layout>
				<s:VerticalLayout paddingLeft="10"/>
			</s:layout>
			<s:Label text="Initiation" fontSize="18"/>
			<s:Group>
				<s:layout>
					<s:VerticalLayout/>
				</s:layout>
				
				<s:Group>
					<s:layout>
						<s:HorizontalLayout/>
					</s:layout>
					<s:RadioButton groupName="initiationGroup" id="tapAnywhere" value="anywhere" label="Tap Anywhere" fontSize="14"/>
					<s:RadioButton groupName="initiationGroup" id="tapObject" value="object" label="Tap Object"  fontSize="14"/>
				</s:Group>
			</s:Group>
		</s:Group>
		
		<s:Group width="100%">
			<s:layout>
				<s:VerticalLayout paddingLeft="{KSketchStyles.DIALOG_PADDING_10}" horizontalAlign="right"/>
			</s:layout>
			<s:Button id="closeButton" label="Close" click="close()" height="{KSketchStyles.DIALOG_MEASUREMENT_25}"/>
		</s:Group>
	</s:Group>
</s:SkinnablePopUpContainer>
