<?xml version="1.0" encoding="utf-8"?>
<!--
*Copyright 2010-2012 Singapore Management University
*Developed under a grant from the Singapore-MIT GAMBIT Game Lab

*This Source Code Form is subject to the terms of the
*Mozilla Public License, v. 2.0. If a copy of the MPL was
*not distributed with this file, You can obtain one at
*http://mozilla.org/MPL/2.0/.
-->
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" width="100" height="40">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import mx.core.UIComponent;
			
			import org.gestouch.events.GestureEvent;
			import org.gestouch.gestures.PanGesture;
			import org.gestouch.gestures.TapGesture;
			
			import sg.edu.smu.ksketch2.KSketch2;
			
			public static const LABEL_CURRENT_TIME:int = -1;
			public static const LABEL_MAX_TIME:int = 1;
			
			private var _KSketch:KSketch2;
			private var _type:int;
			private var _timeControl:KTouchTimeControl;
		
			private var _panGesture:PanGesture;
			private var _tapGesture:TapGesture;
			
			public function init(KSketchInstance:KSketch2, timeControl:KTouchTimeControl, type:int , inputComponent:UIComponent):void
			{
				_KSketch = KSketchInstance;
				_timeControl = timeControl;
				_type = type;
				
				_panGesture = new PanGesture(inputComponent);
				_panGesture.addEventListener(org.gestouch.events.GestureEvent.GESTURE_CHANGED, _panUpdate);
				_panGesture.addEventListener(org.gestouch.events.GestureEvent.GESTURE_ENDED, _panEnd);
				
				_tapGesture = new TapGesture(inputComponent);
				_tapGesture.addEventListener(org.gestouch.events.GestureEvent.GESTURE_RECOGNIZED, _handleTap);
				
				graphics.lineStyle(1,0x000000);
				
				if(_type == LABEL_CURRENT_TIME)
				{
					graphics.beginFill(0x000000);
					graphics.moveTo(20,20);
					graphics.lineTo(40,30);
					graphics.lineTo(40,10);
					graphics.lineTo(20,20);
					graphics.endFill();
					
					graphics.beginFill(0x000000);
					graphics.moveTo(45,20);
					graphics.lineTo(65,30);
					graphics.lineTo(65,10);
					graphics.lineTo(45,20);
					graphics.endFill();
					
					graphics.beginFill(0x000000);
					graphics.moveTo(70,20);
					graphics.lineTo(90,30);
					graphics.lineTo(90,10);
					graphics.lineTo(70,20);
					graphics.endFill();
				}
				else
				{
					graphics.beginFill(0x000000);
					graphics.moveTo(30,20);
					graphics.lineTo(10,30);
					graphics.lineTo(10,10);
					graphics.lineTo(30,20);
					graphics.endFill();
					
					graphics.beginFill(0x000000);
					graphics.moveTo(55,20);
					graphics.lineTo(35,30);
					graphics.lineTo(35,10);
					graphics.lineTo(55,20);
					graphics.endFill();
					
					graphics.beginFill(0x000000);
					graphics.moveTo(80,20);
					graphics.lineTo(60,30);
					graphics.lineTo(60,10);
					graphics.lineTo(80,20);
					graphics.endFill();
				}
			}
			
			/**
			 * Tap handler to handle tapping to advance/roll back frames
			 */
			private function _handleTap(event:org.gestouch.events.GestureEvent):void
			{
				_timeControl.jumpInDirection(_type)
			}
			
			private function _panUpdate(event:org.gestouch.events.GestureEvent):void
			{
				_timeControl.updateSlider(_panGesture.offsetX);
			}
			
			private function _panEnd(event:org.gestouch.events.GestureEvent):void
			{
				_timeControl.resetSliderInteraction();
			}
			
			private function _updateCurrentTime(event:Event):void
			{
				//timeLabel.text = toTimeCode(_KSketch.time);
			}
			
			private function _updateMaxTime(event:Event):void
			{
				//timeLabel.text = toTimeCode(_timeControl.maximum);
			}
			
			public static function toTimeCode(milliseconds:Number):String
			{
				var seconds:int = Math.floor((milliseconds/1000));
				var strSeconds:String = seconds.toString();
				if(seconds < 10)
					strSeconds = "0" + strSeconds;
				
				
				var remainingMilliseconds:int = (milliseconds%1000)/10;
				var strMilliseconds:String = remainingMilliseconds.toString();
				strMilliseconds = strMilliseconds.charAt(0) + strMilliseconds.charAt(1);
				
				if(remainingMilliseconds < 10)
					strMilliseconds = "0" + strMilliseconds;
				
				var timeCode:String = strSeconds + ':' + strMilliseconds;
				return timeCode;
			}
		]]>
	</fx:Script>
	<s:Group width="100%" height="100%"> 
		<s:Rect width="100%" height="100%" alpha="0">
			<s:fill>
				<s:SolidColor color="0xFF0000"/>
			</s:fill>
		</s:Rect>
	</s:Group>
</s:Group>